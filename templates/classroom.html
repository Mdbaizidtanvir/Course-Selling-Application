{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-8 grid grid-cols-1 md:grid-cols-12 gap-6">

  <!-- Left: Lesson Video / Content -->
  <div class="md:col-span-8 bg-white rounded-2xl shadow-xl p-6">
    {% if selected_lesson %}

      <!-- Embed Video (optional) -->
{% if selected_lesson.video_url %}
  <div class="aspect-w-16 aspect-h-9 mb-6 rounded-xl overflow-hidden shadow-md">
    {% if "youtube.com" in selected_lesson.video_url or "youtu.be" in selected_lesson.video_url %}
      {% with youtube_id=selected_lesson.video_url|cut:"https://youtu.be/"|cut:"https://www.youtube.com/watch?v=" %}
        <iframe
          class="w-full h-full"
          src="https://www.youtube.com/embed/{{ youtube_id }}"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen>
        </iframe>
      {% endwith %}
    {% else %}
      <video controls class="w-full h-full rounded-lg"          poster="{{ course.thmb }}"
>
        <source src="{{ selected_lesson.video_url }}" type="video/mp4">
        Your browser does not support the video tag.
      </video>
    {% endif %}
  </div>
{% endif %}

      <h1 class="text-2xl uppercase font-bold text-gray-900 mb-4">{{ selected_lesson.title }}</h1>

<hr class="mt-2 mb-3 bg-black"/>


      <!-- Lesson Content -->
      <div class="prose max-w-none text-gray-700">
        {{ selected_lesson.notes }}
      </div>


<hr class="mt-2 mb-3 bg-black"/>



      <p class="text-gray-900 font-semibold mb-3">Instructor</p>
      <div class="flex items-center gap-4">
        <img class="w-16 h-16 rounded-full shadow-md"
             src="https://eu.ui-avatars.com/api/?name={{ course.instructor.username }}&size=250"
             alt="{{ course.instructor.username }}" />
        <div>
          <p class="uppercase font-semibold text-[16px]">{{ course.instructor.username }}</p>
          <p class="text-gray-500 text-sm">Published on {{ course.created_at }}</p>
        </div>
      </div>


     <hr class="my-6" />

<p>Available after days , {{ selected_lesson.available_after_days}}</p>

    {% else %}
      <p class="text-gray-500">Please select a lesson to begin.</p>
    {% endif %}
  </div>

  <!-- Right: Sidebar with Lessons -->
  <div class="md:col-span-4 bg-white rounded-2xl shadow-xl p-5 h-full overflow-y-auto">
   <div class="relative w-full overflow-hidden rounded-2xl shadow-xl mb-6 h-60">
  <!-- Background Image -->
  <img src="{{ course.cover_url }}" alt="{{ course.title }}"
       class="absolute inset-0 w-full h-60 object-cover rounded-2xl z-0" />

  <!-- Dark Gray Overlay -->
  <div class="absolute inset-0 bg-gray-800/80 rounded-2xl z-10 flex items-center justify-center">
    <h1 class="text-white text-xl md:text-3xl font-bold uppercase text-center px-4">
      {{ course.title }}
    </h1>
  </div>
</div>


{% if all_completed %}
        <p class="text-white text-xs bg-black  font-semibold mb-6 mt-2">✔ Completed the {{ course.title }}</p>

{% endif %}




   
    <div class="space-y-6">
      {% for module in modules %}
        <div>
          <h3 class="text-sm font-bold uppercase text-gray-500 mb-2 tracking-wide">{{ module.title }}</h3>
          <ul class="space-y-1">
{% for lesson in module.lessons.all %}
  <li class="relative">
    <a href="{% url 'classroom_view' course.id lesson.id %}"
       class="flex items-center justify-between gap-4 px-4 py-3 rounded-lg text-sm transition group
              {% if lesson.id == selected_lesson.id %}
                bg-blue-100 text-blue-700 font-semibold
              {% else %}
                text-gray-700 hover:bg-gray-100
              {% endif %}">

      <div class="flex items-center gap-3">
        <div class="bg-indigo-700 group-hover:bg-black/60 p-[6px] rounded-full transition">
          <!-- Icon -->
          <svg xmlns="http://www.w3.org/2000/svg" class="h-[24px] w-[24px] text-white" fill="none" viewBox="0 0 24 24"
               stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M14.752 11.168l-5.197-3.028A1 1 0 008 9.028v5.944a1 1 0 001.555.832l5.197-3.028a1 1 0 000-1.664z" />
          </svg>
        </div>
        <p class="text-xs uppercase font-medium">{{ lesson.title }}</p>
      </div>

      {% if lesson.id in completed_lessons %}
        <span class="text-green-500 text-xs font-semibold">✔ Completed</span>
      {% else %}
        <a href="{% url 'mark_lesson_complete' course.id lesson.id %}"
           class="text-[10px] px-3 py-1 bg-indigo-600 absolute right-0 top-0 text-white rounded-md hover:bg-indigo-700 transition">
          Mark
        </a>
      {% endif %}

    </a>
  </li>
{% endfor %}


          </ul>
        </div>
      {% endfor %}
    </div>
  </div>




</div>




<h2 class="text-xl px-4 font-bold mb-4 text-gray-800 dark:text-white">Related Courses</h2>
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-4 px-4">
  {% for course in related_courses %}
    <div class="bg-white dark:bg-gray-900 rounded-xl shadow-sm hover:shadow-md transition duration-300 border border-gray-100 dark:border-gray-800">
      
      <!-- Image -->
      <img src="{{ course.thmb|default:'https://via.placeholder.com/400x250?text=Course+Image' }}"
           alt="{{ course.title }}"
           class="w-full h-48 object-cover rounded-t-xl">
      
      <!-- Content -->
      <div class="p-5 space-y-3">
        
        <div class="flex items-center justify-between text-xs text-gray-500 dark:text-gray-400">
          <span class="bg-indigo-100 text-indigo-600 dark:bg-indigo-800 dark:text-indigo-200 px-2 py-0.5 rounded-full font-semibold">
            {{ course.category.name }}
          </span>
          <span class="uppercase tracking-wide font-medium text-indigo-500 dark:text-indigo-300">
            {{ course.course_type }}
          </span>
        </div>
        
        <h2 class="text-lg font-semibold text-gray-800 dark:text-white">
          <a href="{% url 'course_detail' course.id %}" class="hover:underline">
            {{ course.title }}
          </a>
        </h2>
        
        <p class="text-sm text-gray-600 dark:text-gray-400">
          {{ course.description|truncatechars:100 }}
        </p>

        <p class="text-xs text-gray-400">Instructor: {{ course.instructor.username }}</p>

        <div class="flex justify-between items-center pt-2">
          {% if course.is_free %}
            <span class="text-green-500 font-bold text-sm">Free</span>
          {% else %}
            <span class="text-indigo-600 font-bold text-sm">${{ course.price }}</span>
          {% endif %}

          <a href="{% url 'course_detail' course.id %}"
             class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-1.5 text-xs rounded-full transition">
            Enroll
          </a>
        </div>

      </div>
    </div>
  {% empty %}
    <p class="text-gray-500 col-span-full">No related courses found.</p>
  {% endfor %}
</div>


{% endblock %}
