{% extends 'base.html' %}
{% block title %}All Courses | LMS{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-10">

  <!-- Banner -->
  <div class="bg-indigo-600 text-white rounded-2xl p-8 text-center mb-8 shadow-lg">
    <h1 class="text-3xl md:text-4xl font-bold mb-2">Explore All Courses</h1>
    <p class="text-md md:text-lg">Find the perfect course to boost your skills. Use search and filters below.</p>
  </div>

  <!-- Search & Filters -->
  <div class="flex flex-col md:flex-row justify-between items-center gap-4 mb-6">
    <form method="get" class="flex flex-1 gap-2 w-full md:w-auto">
      <input 
        type="text" 
        name="q" 
        value="{{ query|default:'' }}" 
        placeholder="Search courses..." 
        class="flex-1 px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:outline-none"
      />
      <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition">Search</button>
    </form>

    <div class="flex gap-2">
      <form method="get" class="flex gap-2">
        <input type="hidden" name="q" value="{{ query|default:'' }}">
        <select name="course_type" onchange="this.form.submit()" class="px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500">
          <option value="">All Types</option>
          <option value="BEGINNER" {% if course_type == "BEGINNER" %}selected{% endif %}>Beginner</option>
          <option value="INTERMEDIATE" {% if course_type == "INTERMEDIATE" %}selected{% endif %}>Intermediate</option>
          <option value="ADVANCED" {% if course_type == "ADVANCED" %}selected{% endif %}>Advanced</option>
        </select>

        <select name="is_free" onchange="this.form.submit()" class="px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500">
          <option value="">All</option>
          <option value="1" {% if is_free == "1" %}selected{% endif %}>Free</option>
          <option value="0" {% if is_free == "0" %}selected{% endif %}>Paid</option>
        </select>
      </form>
    </div>
  </div>

  <!-- Courses Grid -->
  {% if page_obj %}
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {% for course in page_obj %}
    <div class="bg-white rounded-2xl shadow hover:shadow-lg transition overflow-hidden">
      <img src="{{ course.thmb|default:'https://images.unsplash.com/photo-1516321318423-f06f85e504b3' }}" class="w-full h-48 object-cover">
      <div class="p-5">
        <span class="text-xs text-gray-500 uppercase">{{ course.course_type }}</span>
        <h2 class="text-lg font-semibold mt-1">{{ course.title }}</h2>
        <p class="text-sm text-gray-600 mt-2 truncate">{{ course.description|truncatechars:100 }}</p>
        <p class="text-sm text-gray-400 mt-1">Category: {{ course.category }}</p>
        <p class="text-sm text-gray-400 mt-1">Created: {{ course.created_at|date:"M d, Y" }}</p>
        <div class="flex justify-between items-center mt-4">
          <span class="text-indigo-600 font-bold">{{ course.is_free|yesno:"Free,$"|add:course.price }}</span>
          {% if user.is_authenticated and user.is_instructor and user == course.instructor %}
          <a href="{% url 'instructor_edit_course' course.id %}" class="bg-indigo-600 px-3 py-1 rounded-full text-white text-sm hover:bg-indigo-700 transition">Edit</a>
          {% else %}
          <a href="#" class="bg-indigo-600 px-3 py-1 rounded-full text-white text-sm hover:bg-indigo-700 transition">View</a>
          {% endif %}
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Pagination -->
  <div class="mt-8 flex justify-center">
    <nav class="inline-flex">
      {% if page_obj.has_previous %}
      <a href="?{% if query %}q={{ query }}&{% endif %}{% if course_type %}course_type={{ course_type }}&{% endif %}{% if is_free %}is_free={{ is_free }}&{% endif %}page={{ page_obj.previous_page_number }}" class="px-3 py-1 bg-gray-200 rounded-l hover:bg-gray-300">&laquo; Previous</a>
      {% else %}
      <span class="px-3 py-1 bg-gray-100 rounded-l text-gray-400">&laquo; Previous</span>
      {% endif %}

      {% for num in page_obj.paginator.page_range %}
        {% if page_obj.number == num %}
          <span class="px-3 py-1 bg-indigo-600 text-white">{{ num }}</span>
        {% elif num >= page_obj.number|add:-2 and num <= page_obj.number|add:2 %}
          <a href="?{% if query %}q={{ query }}&{% endif %}{% if course_type %}course_type={{ course_type }}&{% endif %}{% if is_free %}is_free={{ is_free }}&{% endif %}page={{ num }}" class="px-3 py-1 bg-gray-200 hover:bg-gray-300">{{ num }}</a>
        {% endif %}
      {% endfor %}

      {% if page_obj.has_next %}
      <a href="?{% if query %}q={{ query }}&{% endif %}{% if course_type %}course_type={{ course_type }}&{% endif %}{% if is_free %}is_free={{ is_free }}&{% endif %}page={{ page_obj.next_page_number }}" class="px-3 py-1 bg-gray-200 rounded-r hover:bg-gray-300">Next &raquo;</a>
      {% else %}
      <span class="px-3 py-1 bg-gray-100 rounded-r text-gray-400">Next &raquo;</span>
      {% endif %}
    </nav>
  </div>

  {% else %}
    <p class="text-gray-600 text-center mt-10">No courses found.</p>
  {% endif %}

</div>
{% endblock %}
